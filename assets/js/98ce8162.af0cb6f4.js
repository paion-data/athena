"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[325],{4714:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var a=n(4848),o=n(8453);const s={title:"Getting Started",description:"Getting Started",sidebar_position:8},i=void 0,r={id:"start",title:"Getting Started",description:"Getting Started",source:"@site/docs/start.md",sourceDirName:".",slug:"/start",permalink:"/athena/docs/start",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/start.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Getting Started",description:"Getting Started",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Glossary",permalink:"/athena/docs/glossary"},next:{title:"File Stores",permalink:"/athena/docs/filestores/"}},l={},c=[{value:"Docker Compose",id:"docker-compose",level:3},{value:"Extending Athena Compose",id:"extending-athena-compose",level:4},{value:"MySQL Container (Meta Store)",id:"mysql-container-meta-store",level:4},{value:"Networking in Athena Compose",id:"networking-in-athena-compose",level:4},{value:"Build From Source",id:"build-from-source",level:3},{value:"Create a Deployable War File",id:"create-a-deployable-war-file",level:4},{value:"Install Jetty",id:"install-jetty",level:4},{value:"Download Jetty",id:"download-jetty",level:5},{value:"Install",id:"install",level:5},{value:"Drop the &quot;.war&quot; File into the Jetty &quot;webapp&quot;",id:"drop-the-war-file-into-the-jetty-webapp",level:5},{value:"Start the Webservice",id:"start-the-webservice",level:4},{value:"Firing The First Request",id:"firing-the-first-request",level:4},{value:"Testing Documentation",id:"testing-documentation",level:3},{value:"Reference - Apache Commons DBCP2",id:"reference---apache-commons-dbcp2",level:3},{value:"Derby",id:"derby",level:3}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["The easiest way to get started with Athena is to use the ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books",children:"Athena Book App Starter"}),". The\nstarter bundles all of the dependencies we will need to stand up a web service. This tutorial uses the starter, and\nall of the code is ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books",children:"available here"}),". We will deploy and play with this example locally\nContents"]}),"\n",(0,a.jsx)(t.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,a.jsxs)(t.p,{children:["Athena Compose is a tool for setting up and running a full-fledged Athena instance Docker application. With Compose,\nan Athena application is backed by a real MySQL meta store and an in-memory OpenStack Swift service. With a single\ncommand, we will be able to create and start all the services from Athena. ",(0,a.jsx)(t.strong,{children:"It's the quickest approach to get a taste\nof Athena"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Athena Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can\nlearn more about it from ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books",children:"source code"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"Using Athena Compose is basically a three-step process:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Package Athena at project root with ",(0,a.jsx)(t.code,{children:"mvn clean package"})]}),"\n",(0,a.jsxs)(t.li,{children:["cd into ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books",children:"compose top directory"})," and fire-up ",(0,a.jsx)(t.code,{children:"docker compose up"})]}),"\n",(0,a.jsxs)(t.li,{children:["hit Athena at ",(0,a.jsx)(t.code,{children:"http://localhost/v1/metadata/graphql?query={metaData(fileId:%221%22){fileName}}"})," with your favorite\nbrowser"]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["For more information about the Athena Compose the ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books",children:"Compose file definition"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"Athena Compose has ability for managing the whole lifecycle of an Athena application:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Start, stop, and rebuild services"}),"\n",(0,a.jsx)(t.li,{children:"View the status of running services"}),"\n",(0,a.jsx)(t.li,{children:"Stream the log output of running services"}),"\n",(0,a.jsx)(t.li,{children:"Run a one-off command on a service"}),"\n"]}),"\n",(0,a.jsx)(t.h4,{id:"extending-athena-compose",children:"Extending Athena Compose"}),"\n",(0,a.jsx)(t.p,{children:"Happy with Athena? You can go further with productionizing Athena from here"}),"\n",(0,a.jsx)("img",{src:"https://user-images.githubusercontent.com/16126939/174438007-b9adae25-baf8-42a7-bf39-83786435d397.gif",width:"40"}),"\n",(0,a.jsx)(t.p,{children:"If you would like to go from basic Athena Compose setup and changed anything, rebuild it with"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"docker compose up --build --force-recreate\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Athena Compose has been tested with ",(0,a.jsx)(t.a,{href:"https://hub.docker.com/_/mysql",children:"MySQL 5.7"})," connected using\n",(0,a.jsx)(t.em,{children:"mysql-connector-java 5.1.38"})," within Athena running on ",(0,a.jsx)(t.a,{href:"https://hub.docker.com/_/jetty",children:"Jetty 9.3"}),"."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["Please take extra caution with MySQL 8, as some of the features might not work properly on Athena Compose. In\naddition, make sure ",(0,a.jsx)(t.code,{children:"?autoReconnect=true&useSSL=false"})," is in connection string. For example,\n",(0,a.jsx)(t.code,{children:"jdbc:mysql://db:3306/Athena?autoReconnect=true&useSSL=false"})]}),"\n"]}),"\n",(0,a.jsx)(t.h4,{id:"mysql-container-meta-store",children:"MySQL Container (Meta Store)"}),"\n",(0,a.jsx)(t.p,{children:"Athena Compose uses MySQL 5 as the backing meta store, i.e. the database that DataFetcher is talking to for file\nmetadata."}),"\n",(0,a.jsx)(t.p,{children:"The MySQL instance is network-reachable at 3306 inside compose and 3305 for host (wo choose 3305 just in case 3306 has\nalready been occupied)"}),"\n",(0,a.jsx)(t.h4,{id:"networking-in-athena-compose",children:"Networking in Athena Compose"}),"\n",(0,a.jsxs)(t.p,{children:["By default Athena Compose sets up a single\n",(0,a.jsx)(t.a,{href:"https://docs.docker.com/engine/reference/commandline/network_create/",children:"network"})," for your app. Both Athena and MySQL\ncontainer services join this default network and is both reachable by other containers on that network, and discoverable\nby them at a hostname identical to the container name."]}),"\n",(0,a.jsxs)(t.p,{children:["For example, inside ",(0,a.jsx)(t.a,{href:"https://github.com/paion-data/athena/tree/master/athena-examples/athena-example-books/docker-compose.yml",children:"docker-compose.yml"})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'services:\n  web:\n    build: .\n    ports:\n      - "80:8080"\n    depends_on:\n      db:\n        condition: service_healthy\n  db:\n    image: "mysql:5.7"\n    ports:\n      - "3305:3306"\n    volumes:\n      - "./mysql-init.sql:/docker-entrypoint-initdb.d/mysql-init.sql"\n    environment:\n      MYSQL_ROOT_PASSWORD: root\n    healthcheck:\n      test: mysqladmin ping -h localhost -u root -proot\n      timeout: 3s\n      retries: 3\n'})}),"\n",(0,a.jsx)(t.p,{children:"When you run docker compose up, the following happens:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:'A network called "athena-example-books" is created.'}),"\n",(0,a.jsx)(t.li,{children:'An Athena container is created using athena-example-books configuration. It joins the network "athena-example-books"\nunder the name "web".'}),"\n",(0,a.jsxs)(t.li,{children:["An MySQL container is created using ",(0,a.jsx)(t.code,{children:"db"}),'\'s configuration. It joins the network "athena-example-books" under the name\n"db".']}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Each container can now look up the hostname ",(0,a.jsx)(t.code,{children:"web"})," or ",(0,a.jsx)(t.code,{children:"db"})," and get back the appropriate container's IP address. For\nexample, web's application code could connect to the URL \"mysql://db:3306\" and start using the MySQL database."]}),"\n",(0,a.jsx)(t.h3,{id:"build-from-source",children:"Build From Source"}),"\n",(0,a.jsx)(t.h4,{id:"create-a-deployable-war-file",children:"Create a Deployable War File"}),"\n",(0,a.jsx)(t.p,{children:'We build the ".war" File first by navigating to athena project root and execute'}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"cd path-to-athena-root/\n"})}),"\n",(0,a.jsx)(t.p,{children:"and compile the project"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"mvn clean package\n"})}),"\n",(0,a.jsxs)(t.p,{children:['Successfully executing the command above shall generate a ".war" file under\n',(0,a.jsx)(t.code,{children:"path-to-athena-root/athena-examples/athena-example-books/target/athena-example-books-<athena-version>.war"}),", where\nis the version of the athena, for example ",(0,a.jsx)(t.code,{children:"1.0.2"}),", please make sure to replace ",(0,a.jsx)(t.code,{children:"<athena-version>"})," with one of our\nrelease versions."]}),"\n",(0,a.jsx)(t.h4,{id:"install-jetty",children:"Install Jetty"}),"\n",(0,a.jsx)(t.h5,{id:"download-jetty",children:"Download Jetty"}),"\n",(0,a.jsxs)(t.p,{children:["At ",(0,a.jsx)(t.a,{href:"https://www.eclipse.org/jetty/download.php",children:"download page"}),", pick up a ",(0,a.jsx)(t.code,{children:".tgz"}),' distribution, we will use\n"9.4.44.v20210927" release as an example:']}),"\n",(0,a.jsx)("img",{src:"../../../assets/img/download-jetty.png",class:"img-fluid",alt:"Error loading download-jetty.png"}),"\n",(0,a.jsx)(t.h5,{id:"install",children:"Install"}),"\n",(0,a.jsxs)(t.p,{children:["Put the ",(0,a.jsx)(t.code,{children:"tar.gz"})," file into a location of your choice as the install path and extract the Jetty binary using"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"tar -czvf jetty-distribution-9.4.44.v20210927.tar.gz\n"})}),"\n",(0,a.jsx)(t.h5,{id:"drop-the-war-file-into-the-jetty-webapp",children:'Drop the ".war" File into the Jetty "webapp"'}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"cd jetty-distribution-9.4.44.v20210927/webapps/\nmv /path/to/.war .\n"})}),"\n",(0,a.jsxs)(t.p,{children:['Then rename the war file to "ROOT.war", the reason of which is so that the context path would be root context - ',(0,a.jsx)(t.code,{children:"/"}),",\nwhich is a common industry standard."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"\ud83d\udccb Setting a Context Path"}),"\n",(0,a.jsxs)(t.p,{children:["The context path is the prefix of a URL path that is used to select the context(s) to which an incoming request is\npassed. Typically a URL in a Java servlet server is of the format\n",(0,a.jsx)(t.code,{children:"http://hostname.com/contextPath/servletPath/pathInfo"}),', where each of the path elements can be zero or more "/"\nseparated elements. If there is no context path, the context is referred to as the ',(0,a.jsx)(t.strong,{children:"root context"}),'. The root context\nmust be configured as "/" but is reported as the empty string by the servlet\n',(0,a.jsxs)(t.a,{href:"https://www.eclipse.org/jetty/",children:["API ",(0,a.jsx)(t.code,{children:"getContextPath()"})," method"]}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["How we set the context path depends on how we deploy the web application (or ",(0,a.jsx)(t.code,{children:"ContextHandler"}),"). In this case, we\nconfigure the context path by ",(0,a.jsx)(t.strong,{children:"naming convention"}),":"]}),"\n",(0,a.jsxs)(t.p,{children:["If a web application is deployed using the WebAppProvider of the DeploymentManager without an XML IoC file, then ",(0,a.jsx)(t.strong,{children:"the\nname of the WAR file is used to set the context path"}),":"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:['If the WAR file is named "myapp.war", then the context will be deployed with a context path of ',(0,a.jsx)(t.code,{children:"/myapp"})]}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsxs)(t.strong,{children:['If the WAR file is named "ROOT.WAR" (or any case insensitive variation), then the context will be deployed with a\ncontext path of ',(0,a.jsx)(t.code,{children:"/"})]})}),"\n",(0,a.jsxs)(t.li,{children:['If the WAR file is named "ROOT-foobar.war" (or any case insensitive variation), then the context will be deployed\nwith a context path of / and a\n',(0,a.jsx)(t.a,{href:"https://www.eclipse.org/jetty/documentation/jetty-9/index.html#configuring-virtual-hosts",children:"virtual host"}),' of "foobar"']}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h4,{id:"start-the-webservice",children:"Start the Webservice"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"cd ../\njava -jar start.jar\n"})}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"\ud83d\udccb To specify the port that container exposes for our app, we could use"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"java -jar start.jar -Djetty.port=8081\n"})}),"\n"]}),"\n",(0,a.jsx)(t.h4,{id:"firing-the-first-request",children:"Firing The First Request"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"brew install --cask graphiql\n"})}),"\n",(0,a.jsx)(t.h3,{id:"testing-documentation",children:"Testing Documentation"}),"\n",(0,a.jsx)(t.p,{children:"The tests contain 2 parts"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Groovy Spock unit tests on"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/groovy/com/paiondata/athena/example/books/application/SQLQueryDataFetcherSpec.groovy",children:"Injected Query DataFetcher"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/groovy/com/paiondata/athena/example/books/application/SQLMutationDataFetcherSpec.groovy",children:"Injected Mutation DataFetcher"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Live DB tests on endpoints"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["In ",(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/groovy/com/paiondata/athena/example/books/web/endpoints/FileServletSpec.groovy",children:"file servlet endpoint test"}),"\nand\n",(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/groovy/com/paiondata/athena/example/books/web/endpoints/MetaServletSpec.groovy",children:"meta data servlet endpoint test"}),",\n",(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/groovy/com/paiondata/athena/example/books/application/SQLDBResourceManager.groovy",children:"Flyway migration"}),"\ninjects real data into a Derby in-meomroy SQL DB"]}),"\n",(0,a.jsxs)(t.li,{children:["The Derby data is injected via a shared ",(0,a.jsx)(t.a,{href:"#reference---apache-commons-dbcp2",children:"DBCP DataSource"})," declared in\n",(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/main/java/com/paiondata/athena/example/books/application/BooksBinderFactory.java",children:"application BinderFactory"})]}),"\n",(0,a.jsxs)(t.li,{children:["The application resource is set alive through\n",(0,a.jsx)(t.a,{href:"../../../../athena-examples/athena-example-books/src/test/java/com/paiondata/athena/example/books/application/BookJerseyTestBinder.java",children:"JerseyTestBinder"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"reference---apache-commons-dbcp2",children:"Reference - Apache Commons DBCP2"}),"\n",(0,a.jsx)(t.p,{children:"For testing Book example application, we use Derby's in-memory database facility, which resides completely in main\nmemory, not in the file system."}),"\n",(0,a.jsxs)(t.p,{children:["In addition, we use ",(0,a.jsx)(t.a,{href:"https://commons.apache.org/proper/commons-dbcp/",children:"Apache DBCP 2"})," to provide ",(0,a.jsx)(t.a,{href:"https://gitbox.apache.org/repos/asf?p=commons-dbcp.git;a=blob_plain;f=doc/BasicDataSourceExample.java;hb=HEAD",children:"DataSource"}),"\npointing at the in-memory Derby instance."]}),"\n",(0,a.jsx)(t.h3,{id:"derby",children:"Derby"}),"\n",(0,a.jsx)(t.p,{children:"Derby was meant to be used only in tests and, hence, must be imported in test scope only"})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var a=n(6540);const o={},s=a.createContext(o);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);